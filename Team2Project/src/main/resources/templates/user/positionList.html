<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link rel="icon" href="/image/icon/logo_icon.png"/> 
<title>Work Wave ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css"/>
<link rel="stylesheet" th:href="@{/css/include.css}">
<link rel="stylesheet" th:href="@{/css/userCont.css}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
</head>
<body>
	<div th:replace="~{include/header}"></div>
	<div layout:fragment="content" class="content">
		<div class="sidebar active">
      		<h3>í¬ì§€ì…˜ ì œì•ˆ</h3>
	        <a th:href="@{/U/profile/insert}">ì´ë ¥ì„œ ë“±ë¡</a>
	        <a th:href="@{/U/profile}">ì´ë ¥ì„œ ë¦¬ìŠ¤íŠ¸</a>
	        <a th:href="@{/U/applyList}">ì…ì‚¬ì§€ì› í˜„í™©</a>
	        <a th:href="@{/U/userPosition}" class="select">í¬ì§€ì…˜ ì œì•ˆ</a>
	        <a th:href="@{/U/update/userPwdCheck}">íšŒì›ì •ë³´ ìˆ˜ì •</a>
	        <a th:href="@{/U/update/pwd/companyPwdCheck}">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
	        <a th:href="@{/U/delete/userPwdCheck}">íšŒì›íƒˆí‡´</a>
        </div>
        
   		<div class="user-info sidebar_r">
   			<h3>í¬ì§€ì…˜ ì œì•ˆ</h3>
   			<ul>
	   			<li>
		      		<span style="font-size: 14px; font-weight: bold; margin-right: 150px;">
		      			ğŸ”” ì´ë ¥ì„œ ì™„ì„±í•˜ë©´, ê¸°ì—…ì—ê²Œ ë¨¼ì € í¬ì§€ì…˜ ì œì•ˆì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!
		      		</span>
		      		<a class="profilego" th:href="@{/U/profile/insert}">ì´ë ¥ì„œ ì™„ì„±í•˜ê¸° ></a>
	      		</li>
      		</ul>
      	
      	<br> <br>
			
			<ul class="user-list2" th:if="${positionInfoList != null}">
	            <li style="background-color: #f2f2f2; text-align: center">
	                <span style="width: 60%;">ê¸°ì—…/í¬ì§€ì…˜ ëª…</span>|
	                <span style="width: 20%;">ë§ˆê°ì¼</span>|
	                <span style="width: 20%;">ì œì•ˆì§„í–‰ìƒíƒœ</span>|
	            </li>
	            <li style="display: flex; align-items: center; height: auto; padding: 10px; line-height: 24px;"
	            	th:each="positionInfo, stat : ${positionInfoList}">
	                <span style="width: 60%; text-align: left; margin-left: 15px; padding: 10px 0 10px 0;">
	                	  <span style="font-size: 14px;" 
	                	  	    th:text="${positionComList[stat.index].company_name}"></span><br>
	                	  	    
	                	  <span  
	                	        style="font-size: 16px; cursor: pointer; color: #0B57D0;" 
	                	        th:text="${positionInfo.position_title}"
	                	        th:attr="data-com-board-key=${positionInfo.com_board_key},
	                	        		 data-position-key=${positionInfo.position_key},
	                	        		 data-position-title=${positionInfo.position_title},
	                	        	     data-company-name=${positionComList[stat.index].company_name},
	                	        	     data-position-date=${positionInfo.position_date},
	                	        	     data-expiration-date=${positionInfo.expirationDate},
	                	        	     data-position-cont=${positionInfo.position_cont},
	                	        	     data-mgr-name=${positionComList[stat.index].company_mgr_name},
	                	        	     data-mgr-phone=${positionComList[stat.index].company_mgr_phone},
	                	        	     data-mgr-email=${positionComList[stat.index].company_mgr_email}"
	                	        onclick="positionInputModal(this)">
	                	  </span>
	                </span>
	                <span id="expiration-date" 
					      style="width: 20%; text-align: center;"
					      th:text="${positionInfo.expirationDate.substring(0, 10)}">
					</span>
	                <th:block th:if="${positionInfo.position_check == 'N'}">	  
	                	<span style="width: 20%; text-align: center;">ë¯¸ì—´ëŒ</span>
	                </th:block>
	                <th:block th:if="${positionInfo.position_check == 'Y'}">	  
	                	<span style="width: 20%; text-align: center;">ì—´ëŒ</span>
	                </th:block>
	                <th:block th:if="${positionInfo.position_check == 'O'}">	  
	                	<span style="width: 20%; text-align: center;">ì œì•ˆìˆ˜ë½</span>
	                </th:block>
	                <th:block th:if="${positionInfo.position_check == 'X'}">	  
	                	<span style="width: 20%; text-align: center;">ì œì•ˆê±°ì ˆ</span>
	                </th:block>
	            </li>
	            
        	</ul>
        	
        	<ul class="user-list2" th:if="${positionInfoList == null or positionInfoList.isEmpty()}">
        		<li style="text-align: center">
	            	<h3>ì•„ì§ ì œì•ˆì´ ì—†ì–´ìš”..  ğŸ˜‚ğŸ˜‚</h3>
	            </li>
        	</ul>
	       
      	</div>
      	
      		<!-- í¬ì§€ì…˜ ìƒì„¸ ëª¨ë‹¬ -->
      		<div id="recommendModal" class="modal">
      		<input type="hidden" id="apply_com_board_key">
      		<input type="hidden" id="modal_position_key">
		    <table class="position-cont">
				<thead style="font-size: 15px">
					<tr>
						<td id="modal-position-title" colspan="3"></td>
					</tr>
					<tr style="font-weight: bold">
						<td id="modal-company-name" colspan="3"></td>
					</tr>
					<tr>
						<td colspan="2"><span>ì œì•ˆì¼: </span><span id="modal-position-date"></span></td>
						<td><span>ë§ˆê°ì¼: </span><span id="modal-expiration-date"></span></td>
					</tr>
				</thead>
				<tbody align="center" style="line-height: 2;">
					<tr>
						<td id="modal-position-cont" style="font-size: 14px" colspan="3"></td>
					</tr>
				</tbody>
				<tfoot style="font-size: 14px;">
					<tr>
						<th style="width: 22%;" rowspan="3">ì¸ì‚¬ë‹´ë‹¹ì ì •ë³´</th>
						<td id="modal-mgr-name" colspan="2"></td>
					</tr>
					<tr>
						<td id="modal-mgr-phone" colspan="2"></td>
					</tr>
					<tr>
						<td id="modal-mgr-email" colspan="2"></td>
					</tr>
					<tr id="positionBtn">
						<td colspan="3" style="text-align: center;">
							<input type="button" value="ì œì•ˆ ìˆ˜ë½" onclick="jeanOk()" id="positionResultBtn1">
							<input type="button" value="ì œì•ˆ ê±°ì ˆ" onclick="jeanNo()" id="positionResultBtn2">
						</td>
					</tr>
				</tfoot>
			</table>
			
			<div>
				<span id="positionResultOk" style="display: none;">ì´ë¯¸ ìˆ˜ë½í•œ ì œì•ˆì…ë‹ˆë‹¤.</span>
				<span id="positionResultNo" style="display: none;">ì´ë¯¸ ê±°ì ˆí•œ ì œì•ˆì…ë‹ˆë‹¤.</span>
			</div>	
		 	</div>
      	
      	
   <script type="text/javascript" th:inline="javascript">
   		document.addEventListener("DOMContentLoaded", function() {
	    var expirationElement = document.getElementById('expiration-date');
	    var expirationDate = new Date(expirationElement.innerText);
	    var currentDate = new Date();
	    
	    if (currentDate > expirationDate) {
	      expirationElement.innerText = 'ë§ˆê°';
	    }
	  });
   		
   		function positionInputModal(element) {
   			var comBoardKey = element.getAttribute('data-com-board-key');
   	        var positionTitle = element.getAttribute('data-position-title');
   	        var companyName = element.getAttribute('data-company-name');
   	        var positionDate = element.getAttribute('data-position-date');
   	        var expirationDate = element.getAttribute('data-expiration-date');
   	        var positionCont = element.getAttribute('data-position-cont');
   	        var mgrName = element.getAttribute('data-mgr-name');
   	        var mgrPhone = element.getAttribute('data-mgr-phone');
   	        var mgrEmail = element.getAttribute('data-mgr-email');
   	        var positionKey = element.getAttribute("data-position-key");
   	        
   	        document.getElementById('modal-position-title').innerText = positionTitle;
   	        document.getElementById('modal-company-name').innerText = companyName;
   	        document.getElementById('modal-position-date').innerText = positionDate.substring(0, 10);
   	        document.getElementById('modal-expiration-date').innerText = expirationDate.substring(0, 10);
   	        document.getElementById('modal-position-cont').innerText = positionCont;

   	        document.getElementById('modal-mgr-name').innerText = mgrName;
   	        document.getElementById('modal-mgr-phone').innerText = mgrPhone;
   	        document.getElementById('modal-mgr-email').innerText = mgrEmail;

   	        $("#recommendModal").modal();
   	        $("#apply_com_board_key").val(comBoardKey);
   	     	$("#modal_position_key").val(positionKey);
   	        
   	        $.ajax({
   	        	url: '/ajax/position/check',
   	        	type: 'post',
   	        	data: {'check': positionKey},
   	        	success: function() {
   	        		console.log();
   	        	},error: function(xhr, status, error) {
   					console.error(xhr);
   				}
   	        });
   	        
	   	     $.ajax({
	             url: '/ajax/position/result/check',
	             type: 'get',
	             data: {'positionKey': positionKey},
	             success: function(result){
	                 debugger; // ë””ë²„ê¹…ì„ ìœ„í•œ ì¤‘ë‹¨ì  ì„¤ì •
	                 
	                 // ì„œë²„ë¡œë¶€í„° ë°›ì€ ê²°ê³¼(result)ê°€ 'O' ë˜ëŠ” 'X'ì¼ ê²½ìš° ë²„íŠ¼ì„ ë¹„í™œì„±í™”
	                 if(result == 'O' || result == 'X') {
	                     $('#positionResultBtn1').prop('disabled', true); // ë²„íŠ¼ ë¹„í™œì„±í™”
	                     $('#positionResultBtn2').prop('disabled', true); // ë²„íŠ¼ ë¹„í™œì„±í™”
	                     $('#positionBtn').hide(); // ë²„íŠ¼ ë¹„í™œì„±í™”
	                     if(result == 'O'){
	                    	 $('#positionResultOk').show();
	                    	 $('#positionResultNo').hide();
	                     }else if(result == 'X'){
	                    	 $('#positionResultNo').show();
	                    	 $('#positionResultOk').hide();
	                     }
	                 }
	             },
	             error: function(xhr, status, error) {
	                 console.error(xhr); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì½˜ì†”ì— ì˜¤ë¥˜ ì¶œë ¥
	             }
	         });
	   	     
	   		/* // ëª¨ë‹¬ ì°½ ë‹«ê¸° ì´ë²¤íŠ¸ ê°ì§€
	   	    $('#recommendModal').on('hide.bs.modal', function() {
	   	        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
	   	        location.reload();
	   	    }); */
   	        
   	    }
     	// ê³µê³  ì§€ì› ë“±ë¡ / í•´ì œ
   		function jeanOk() {
     		
   			$.ajax({
   				url: '/ajax/apply/insert',
   				type: 'post',
   				data:{"checked":$("#apply_com_board_key").val()},
   				success: function() {
   					alert('ì œì•ˆì„ ìˆ˜ë½í•˜ì…¨ìŠµë‹ˆë‹¤.');
   					$.ajax({
   						url: '/ajax/positionOk',
   						type: 'post',
   						data: {'positionKey': $("#modal_position_key").val()},
   						success: function() {
   							console.log();
   						 	$('#recommendModal').modal('hide');
   					    
   						},error: function(xhr, status, error) {
   		   					console.error(xhr);
   		   				}
   					});
   				},error: function(xhr, status, error) {
   					console.error(xhr);
   				}
   			});
   		}
     	
   	// ê³µê³  ì§€ì› ë“±ë¡ / í•´ì œ
   		function jeanNo() {
     		
   			$.ajax({
   				url: '/ajax/positionNo',
   				type: 'post',
   				data: {'positionKey': $("#modal_position_key").val()},
   				success: function() {
   					console.log();
   					alert('ì œì•ˆì„ ê±°ì ˆí•˜ì…¨ìŠµë‹ˆë‹¤.');
   					$('#recommendModal').modal('hide');
   				},error: function(xhr, status, error) {
	   					console.error(xhr);
	   			}
   			});
   		}
   		
   </script>
   </div>
   <div th:replace="~{include/footer :: footer}"></div>
</body>
</html>